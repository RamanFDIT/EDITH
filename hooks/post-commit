#!/bin/sh
#
# E.D.I.T.H. Post-Commit Hook
# ===========================
# This hook notifies EDITH after every commit so she can analyze changes
# and suggest documentation updates or flag potential issues.
#
# INSTALLATION:
# Copy this file to your repository's .git/hooks/ folder:
#   cp hooks/post-commit .git/hooks/post-commit
#   chmod +x .git/hooks/post-commit  (on Unix/Mac)
#
# Or create a symlink:
#   ln -s ../../hooks/post-commit .git/hooks/post-commit

# EDITH Server URL
EDITH_URL="http://localhost:3000/api/hooks/commit-event"

# Get the commit ID
COMMIT_ID=$(git rev-parse HEAD)

echo "ðŸ¤– [E.D.I.T.H.] Analyzing commit ${COMMIT_ID:0:8}..."

# Ping EDITH (fire and forget - don't block the commit)
# Using curl with timeout to avoid hanging if server is down
curl -s -X POST "$EDITH_URL" \
    -H "Content-Type: application/json" \
    -d "{\"commitId\": \"$COMMIT_ID\"}" \
    --max-time 5 \
    > /dev/null 2>&1 &

# Don't wait for curl to finish - let it run in background
# This ensures the commit completes immediately

echo "ðŸ¤– [E.D.I.T.H.] Analysis queued. Check the dashboard for insights."

exit 0
